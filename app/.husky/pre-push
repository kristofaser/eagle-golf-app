#!/bin/sh
. "$(dirname "$0")/_/husky.sh"

# Aller dans le rÃ©pertoire app
cd app

echo "ğŸ§ª ExÃ©cution des tests avant push..."

# ExÃ©cuter les tests
npm test -- --bail --findRelatedTests --passWithNoTests

# Capturer le code de sortie
TEST_RESULT=$?

# Si les tests Ã©chouent
if [ $TEST_RESULT -ne 0 ]; then
  echo "âŒ Les tests ont Ã©chouÃ©. Push annulÃ©."
  echo "ğŸ’¡ Corrigez les tests avant de pusher."
  exit 1
fi

echo "âœ… Tests passÃ©s avec succÃ¨s!"

# VÃ©rifier le linting
echo "ğŸ” VÃ©rification du linting..."
npm run lint --quiet

LINT_RESULT=$?

if [ $LINT_RESULT -ne 0 ]; then
  echo "âš ï¸  Avertissement: Le linting a dÃ©tectÃ© des problÃ¨mes."
  echo "ğŸ’¡ ExÃ©cutez 'npm run lint --fix' pour corriger automatiquement."
  # On ne bloque pas le push pour le linting pour le moment
fi

echo "âœ… Pre-push checks terminÃ©s!"